!function(){var a=window.cop21||(window.cop21={});a.network=function(){function a(a){a.each(function(m){var p,q={top:5,right:5,bottom:5,left:5},r=i-q.left-q.right,s=h-q.top-q.bottom,t=!0,u=m.delegations,v=m.tables.links,w=m.tables.nodes,x=d3.extent(v,function(a){return a.value});console.log(x);d3.scale.linear().range([0,1]).domain(x);w.forEach(function(a){a.type=a.id,a.radius=l}),u.forEach(function(a){a.radius=j}),u.sort(function(a,b){return d3.ascending(a.entity,b.entity)}),p=a.select("svg").empty()?a.append("svg").attr("width",i).attr("height",h).append("g").attr("width",r).attr("height",s).attr("transform","translate("+q.left+","+q.top+")"):a.select("svg").attr("width",i).attr("height",h).select("g").attr("width",r).attr("height",s).attr("transform","translate("+q.left+","+q.top+")"),n.stop(),o.stop(),n.nodes(w).links(v).size([r,s]),o.nodes(u).size([r,s]),o.on("tick",function(a){for(var b,e=d3.geom.quadtree(o.nodes().concat(n.nodes())),f=.1*a.alpha,g=-1,h=o.nodes().length;++g<h;)b=o.nodes()[g],c=n.nodes().filter(function(a){return a.id==b.delegation})[0],b.x+=(c.x-b.x)*f,b.y+=(c.y-b.y)*f,e.visit(d(b));y.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),A.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}),n.on("tick",function(a){o.start();for(var b=d3.geom.quadtree(n.nodes()),c=-1,e=n.nodes().length;++c<e;)b.visit(d(n.nodes()[c]));z.attr("cx",function(a){return a.x=Math.max(a.radius,Math.min(r-a.radius-k-2*j,a.x)),a.x}).attr("cy",function(a){return a.y=Math.max(a.radius,Math.min(s-a.radius-k-2*j,a.y)),a.y}),B.attr("x",function(a){return a.x=Math.max(a.radius,Math.min(r-a.radius-k-2*j,a.x)),a.x}).attr("y",function(a){return a.y=Math.max(a.radius,Math.min(s-a.radius-k-2*j,a.y)),a.y}),B.attr("transform",function(a){return a.x=Math.max(a.radius,Math.min(r-a.radius-k-2*j,a.x)),a.y=Math.max(a.radius,Math.min(s-a.radius-k-2*j,a.y)),"translate("+a.x+","+a.y+")"})}),o.on("end",function(){!e&&t&&(n.start(),t=!1)});var y=p.selectAll(".del").data(o.nodes(),function(a){return a.entity});y.enter().append("circle").attr("class","del").attr("r",j-k).attr("fill","#00ffff").attr("fill-opacity",.5).attr("cx",0).attr("cy",0).each(function(a){$(this).popover("destroy"),$(this).popover({title:f[a.entity],content:g.filter(function(b){return b.entity==a.entity})[0].history.join(" > "),placement:"auto",container:"body",trigger:"hover",html:!0})}),y.exit().remove();var z=p.selectAll(".tables").data(n.nodes(),function(a){return a.id});z.transition().duration(200).attr("fill-opacity",function(a){return a.degree>=5?1:0}).attr("stroke",function(a){return a.degree>=5?"none":"#4d4d4d"}).attr("stroke-width",function(a){return a.degree>=5?0:1}),z.enter().append("circle").attr("class","tables").attr("r",function(a){return a.radius-k}).attr("fill",function(a){return"#4d4d4d"}).attr("fill-opacity",function(a){return a.degree>=5?1:0}).attr("stroke",function(a){return a.degree>=5?"none":"#4d4d4d"}).attr("stroke-width",function(a){return a.degree>=5?0:1}).attr("cx",0).attr("cy",0),z.exit().transition().duration(200).attr("fill-opacity",0).remove();var A=p.selectAll(".delPoint").data(o.nodes(),function(a){return a.entity});A.enter().append("circle").attr("class","delPoint").attr("r",.5).attr("fill",function(a){return"black"}),A.exit().remove();var B=p.selectAll(".tabLabels").data(n.nodes(),function(a){return a.id});B.transition().duration(200).attr("opacity",function(a){return a.degree>=5?1:.5}),B.enter().append("g").attr("class","tabLabels").attr("opacity",function(a){return a.degree>=5?1:.5}),B.exit().remove(),B.select("text").remove(),B.append("text").attr("text-anchor","middle").attr("dy","0.3em").attr("fill","white").text(function(a){return a.name}).call(b,100),e?n.start():o.start()})}function b(a,b){a.each(function(){var a=d3.select(this),c=a.text().split(/\s+/).reverse();if(!(c.length<2))for(var d,e=[],f=.7,g=a.attr("y"),h=parseFloat(a.attr("dy")),i=a.text(null).append("tspan").attr("x",0).attr("y",g).attr("dy",h+"em");d=c.pop();)e.push(d),i.text(e.join(" ")),i.node().getComputedTextLength()>b&&(e.pop(),i.text(e.join(" ")),e=[d],i=a.append("tspan").attr("x",0).attr("y",g).attr("dy",f+h+"em").text(d))})}function d(a){var b=a.radius+16,c=a.x-b,d=a.x+b,e=a.y-b,f=a.y+b;return function(b,g,h,i,j){if(b.point&&b.point!==a){var k=a.x-b.point.x,l=a.y-b.point.y,m=Math.sqrt(k*k+l*l),n=a.radius+b.point.radius;n>m&&(m=(m-n)/m*.5,a.px+=k*m,a.py+=l*m)}return g>d||c>i||h>f||e>j}}var e,f,g,h=600,i=600,j=6,k=2,l=20,m=!0,n=d3.layout.force().charge(-2e3).linkDistance(function(a){return 15*a.value<40?20:25*a.value}).linkStrength(function(a){return a.value/3}).gravity(.1).friction(.3),o=d3.layout.force().gravity(0).charge(0).friction(.88);return a.height=function(b){return arguments.length?(h=b,a):h},a.width=function(b){return arguments.length?(i=b,a):i},a.delRadius=function(b){return arguments.length?(j=b,a):j},a.delPadding=function(b){return arguments.length?(k=b,a):k},a.tabRadius=function(b){return arguments.length?(l=b,a):l},a.allDelegationsMap=function(b){return arguments.length?(f=b,a):f},a.delegationsHistory=function(b){return arguments.length?(g=b,a):g},a.showLabel=function(b){return arguments.length?(m=b,a):m},a.first=function(b){return arguments.length?(e=b,a):e},a}}(),function(){var a=window.cop21||(window.cop21={});a.sankey=function(){function a(a){a.each(function(g){var h,i,j,k,l=20,m="Delegations",n=d3.format(",.0f"),o=function(a){return n(a)+" "+m},p=(d3.scale.category20(),[c-1,c]),q=e-f.left-f.right,r=d-f.top-f.bottom;if(a.select("svg").empty()?(h=a.append("svg").attr("width",e).attr("height",d).append("g").attr("width",q).attr("height",r).attr("transform","translate("+f.left+","+f.top+")"),c&&(j=h.append("g").attr("class","legend"),j.append("circle").attr("r",8).attr("fill","none").attr("stroke","white").attr("stroke-width",1).attr("cx",5).attr("cy",8),j.append("circle").attr("r",8).attr("fill","none").attr("stroke","white").attr("stroke-width",1).attr("cx",q-5).attr("cy",8),j.append("line").attr("x1",13).attr("y1",8).attr("x2",q-13).attr("y2",8).attr("stroke","white").attr("stroke-width",1),j.append("text").attr("text-anchor","middle").attr("fill","white").attr("class","stepLeft").attr("x",5).attr("y",8).attr("dy","3px"),j.append("text").attr("text-anchor","middle").attr("fill","white").attr("class","stepRight").attr("x",q-5).attr("y",8).attr("dy","3px")),i=h.append("g").attr("transform","translate(0,"+l+")").attr("class","sanviz"),k=i.append("g").attr("class","linkG")):(h=a.select("svg").attr("width",e).attr("height",d).select("g").attr("width",q).attr("height",r).attr("transform","translate("+f.left+","+f.top+")"),j=h.select(".legend"),i=h.select(".sanviz"),k=i.select(".linkG")),c){j.select(".stepLeft").text(p[0]),j.select(".stepRight").text(p[1])}var s=d3.sankey().nodeWidth(5).nodePadding(2).size([q,r-l]),t=s.link();s.nodes(g.nodes).links(g.links).layout(32);var u=k.selectAll(".link").data(g.links);u.transition().duration(500).attr("d",t).attr("stroke-width",function(a){return Math.max(1,a.dy)}).sort(function(a,b){return b.dy-a.dy}),u.enter().append("path").attr("class","link").attr("d",t).attr("stroke-width",function(a){return Math.max(1,a.dy)}).attr("stroke-opacity",.5).sort(function(a,b){return b.dy-a.dy}),u.exit().remove();var v=i.selectAll(".node").data(g.nodes);v.each(function(a){$(this).popover("destroy"),$(this).popover({title:b[a.name.split("_")[0]+"_"+a.name.split("_")[1]],content:o(a.value),placement:"auto top",container:"body",trigger:"hover"})}).on("mouseover",function(a){var b=a.name,c=a.sourceLinks.length?"source":"target";u.transition().attr("stroke-opacity",.2).filter(function(a){return a[c].name==b}).transition().attr("stroke-opacity",.9)}).on("mouseout",function(a){u.transition().attr("stroke-opacity",.5)}).transition().duration(500).attr("height",function(a){return a.dy}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}),v.enter().append("rect").attr("height",function(a){return a.dy}).attr("width",s.nodeWidth()).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("class","node").style("fill","white").each(function(a){$(this).popover("destroy"),$(this).popover({title:b[a.name.split("_")[0]+"_"+a.name.split("_")[1]],content:o(a.value),placement:"auto top",container:"body",trigger:"hover"})}).on("mouseover",function(a){var b=a.name,c=a.sourceLinks.length?"source":"target";u.transition().attr("stroke-opacity",.2).filter(function(a){return a[c].name==b}).transition().attr("stroke-opacity",.9)}).on("mouseout",function(a){u.transition().attr("stroke-opacity",.5)}),v.exit().remove();var w=i.selectAll(".tabLabels").data(g.nodes);w.exit().remove(),w.transition().duration(500).attr("y",function(a){return a.y+a.dy/2}).text(function(a){return a.value>=5?b[a.name.split("_")[0]+"_"+a.name.split("_")[1]]:void 0}).filter(function(a){return a.x<q/2}).text(function(a){return c?null:b[a.name.split("_")[0]+"_"+a.name.split("_")[1]]}),w.enter().append("text").attr("x",function(a){return q-6-s.nodeWidth()}).attr("y",function(a){return a.y+a.dy/2}).attr("dy",".35em").attr("class","tabLabels").attr("text-anchor","end").text(function(a){return a.value>=5?b[a.name.split("_")[0]+"_"+a.name.split("_")[1]]:void 0}).filter(function(a){return a.x<q/2}).attr("x",function(a){return a.x+6+s.nodeWidth()}).attr("text-anchor","start").text(function(a){return c?null:b[a.name.split("_")[0]+"_"+a.name.split("_")[1]]})})}var b,c,d=600,e=600,f={top:5,right:5,bottom:5,left:5},g=!0;return a.height=function(b){return arguments.length?(d=b,a):d},a.width=function(b){return arguments.length?(e=b,a):e},a.currentStep=function(b){return arguments.length?(c=b,a):c},a.showLabel=function(b){return arguments.length?(g=b,a):g},a.allTablesMap=function(c){return arguments.length?(b=c,a):b},a.margin=function(b){return arguments.length?(f=b,a):f},a}}();